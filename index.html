<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>SubWeb</title>
    <link href="Style.css" rel="stylesheet" type="text/css" />
    <script src="js/jquery-1.4.4.min.js" type="text/javascript"></script>
    <script src="js/audiojs/audio.min.js" type="text/javascript"></script>
    <script src="js/jquery.scrollTo-1.4.2-min.js" type="text/javascript"></script>
    <script src="js/jquery.disable.text.select.pack.js" type="text/javascript"></script>
    <script src="js/jquery.cookie.js" type="text/javascript"></script>
    <script src="js/jquery.base64.js" type="text/javascript"></script>
    <script src="js/jquery.shuffle.js" type="text/javascript"></script>
    <script src="js/app.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            // Tabs
            $(".tabcontent").hide(); //Hide all content
            if ($.cookie('username') == null) {
                $('ul.tabs li a').each(function () {
                    if ($(this).attr("href") == '#tabPreferences') {
                        $(this).addClass("active"); //Add "active" class to selected tab                    
                    }
                });
                $("#tabPreferences").show(); //Show first tab content
                loadTabContent('#tabPreferences');
            } else {
                if (window.location.hash) {
                    var hash = window.location.hash;
                    $('ul.tabs li a').each(function () {
                        if ($(this).attr("href") == hash) {
                            $(this).addClass("active"); //Add "active" class to selected tab                    
                        }
                    });
                    $(hash).show(); //Fade in the active ID content
                    loadTabContent(hash);
                } else {
                    $("ul.tabs li:first a").addClass("active").show(); //Activate first tab
                    $(".tabcontent:first").show(); //Show first tab content
                    var firstTab = $("ul.tabs li:first a").attr("href");
                    loadTabContent(firstTab);
                }
            }

            // Tabs - On Click Event
            $("ul.tabs li a").click(function () {
                $("ul.tabs li a").removeClass("active"); //Remove any "active" class
                $(this).addClass("active"); //Add "active" class to selected tab
                $(".tabcontent").hide(); //Hide all tab content

                var activeTab = $(this).attr("href"); //Find the href attribute value to identify the active tab + content
                $(activeTab).show(); //Fade in the active ID content
                loadTabContent(activeTab);
            });

            // Ajax Loading Screen
            $(".toploading").ajaxStart(function () {
                $(this).show();
            });
            $(".toploading").ajaxStop(function () {
                $(this).hide();
            });

            // Keyboard shortcuts
            $('#Artists').keydown(function (e) {
                var unicode = e.charCode ? e.charCode : e.keyCode;
                if (unicode >= 65 && unicode <= 90) {
                    var key = findKeyForCode(unicode);
                    var el = '#index_' + key.toUpperCase();
                    $('#Artists').stop().scrollTo(el);
                }
            });
            $(document).keydown(function (e) {
                var unicode = e.charCode ? e.charCode : e.keyCode;
                // right arrow
                if (unicode == 39) {
                    var next = $('ul.songlist li.playing').next();
                    if (!next.length) next = $('ul.songlist li').first();
                    changeTrack(next);
                    // back arrow
                } else if (unicode == 37) {
                    var prev = $('ul.songlist li.playing').prev();
                    if (!prev.length) prev = $('ul.songlist li').last();
                    changeTrack(prev);
                    // spacebar
                } else if (unicode == 32) {
                    audio.playPause();
                }
            });

            // Multiple Select
            $('.noselect').disableTextSelect();
            var lastChecked = null;
            $('ul.songlist li.song').live('click', function (event) {
                var checkboxclass = 'ul.songlist li.song';
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected');
                } else {
                    $(this).addClass('selected');
                }
                if (!lastChecked) {
                    lastChecked = this;
                    return;
                }
                if (event.shiftKey) {
                    var start = $(checkboxclass).index(this);
                    var end = $(checkboxclass).index(lastChecked);
                    for (i = Math.min(start, end); i <= Math.max(start, end); i++) {
                        $(checkboxclass).eq(i).addClass('selected');
                    }
                }
                lastChecked = this;
            });

            // Action Menu - Click Events
            $('a#action_AddToPlaylist').click(function () {
                var submenu = $('div#submenu');
                if (submenu.is(":visible")) {
                    submenu.fadeOut();
                } else {
                    loadPlaylistsForMenu();
                    submenu.fadeIn(400);
                }
            });
            var submenu_active = false;
            $('div#submenu').mouseenter(function () {
                submenu_active = true;
            });
            $('div#submenu').mouseleave(function () {
                submenu_active = false;
                setTimeout(function () { if (submenu_active === false) $('div#submenu').fadeOut(); }, 400);
            });
            $('#action_RefreshArtists').click(function () {
                loadArtists(true);
                return false;
            });
            $('#action_SelectAll').click(function () {
                $('#Albums li.song').each(function () {
                    $(this).addClass('selected');
                });
                return false;
            });
            $('#action_SelectNone').click(function () {
                $('#Albums li.song').each(function () {
                    $(this).removeClass('selected');
                });
                return false;
            });
            $('input#Search').keydown(function (e) {
                var unicode = e.charCode ? e.charCode : e.keyCode;
                if (unicode == 13) {
                    $('#action_Search').click();
                }
            });
            $('#action_Search').click(function () {
                var query = $('#Search').val();
                search('song', query);
                $('#Search').val("");
                return false;
            });
            $('#action_DeletePlaylist').click(function () {
                if ($('ul#PlaylistContainer li.selected').length > 0) {
                    if (confirmDelete()) {
                        $('ul#PlaylistContainer li.selected').each(function () {
                            deletePlaylist($(this).attr("id"));
                        });
                    }
                }
                return false;
            });
            $('#action_SavePlaylist').click(function () {
                if ($('ul#PlaylistContainer li.selected').length > 0) {
                    $('ul#PlaylistContainer li.selected').each(function () {
                        savePlaylist($(this).attr("id"));
                    });
                }
                return false;
            });
            $('#action_RemoveSongs').click(function () {
                if ($('ul#TrackContainer li.selected').length > 0) {
                    $('ul#TrackContainer li.selected').each(function () {
                        $(this).remove();
                    });
                }
                return false;
            });

            // Player Click Events
            $('#Shuffle').live('click', function () {
                $('ul.songlist').shuffle();
            });


            // Preferences Click Events
            $('#SavePreferences').live('click', function () {
                var username = $('#Username').val();
                var password = $('#Password').val();
                $.cookie('username', username, { expires: 365 });
                $.cookie('password', password, { expires: 365 });
                location.reload(true);
            });
            $('input#Password').keydown(function (e) {
                var unicode = e.charCode ? e.charCode : e.keyCode;
                if (unicode == 13) {
                    $('#SavePreferences').click();
                }
            });
            $('#ResetPreferences').live('click', function () {
                $.cookie('username', null);
                $.cookie('password', null);
            });

        });         // End document.ready

        var a;
        var audio;
        audiojs.events.ready(function () {
            a = audiojs.createAll({
                trackEnded: function () {
                    var next = $('ul.songlist li.playing').next();
                    changeTrack(next);
                }
            });
            // Load in the first track
            audio = a[0];
        });

        function changeTrack(next) {
            if (!next.length) next = $('ul.songlist li').first();
            next.addClass('playing').siblings().removeClass('playing');
            var songid = $(next).attr('childid');
            var albumid = $(next).attr('parentid');
            playSong(songid, albumid);
        }

	</script>
</head>
<body>

<div id="container">
    <div id="nav">
        <ul class="tabs">
        <li><a href="#tabLibrary">Music Library</a></li>
        <li><a href="#tabPlaylists">Playlists</a></li>
        <!--<li><a href="#tabCurrentPlaylist">Current Playlist</a></li>-->
        <li><a href="#tabPreferences" class="last">Preferences</a></li>
        </ul>
        <div class="toploading"></div>
    </div>
    <div id="content">
        <div id="tabLibrary" class="tabcontent">
            <div class="actions floatleft">
                <a href="#" class="button" id="action_RefreshArtists" title="Refresh Artist List"><img src="images/reload_9x11.png" /></a>
            </div>
            <div class="actions floatright">
                <a href="#" class="button" id="action_AddToPlaylist" title="Add Selected To Playlist">+ Playlist <img src="images/arrow_down_8x8.png" /></a>
                <div id="submenu" class="shadow" style="display: none;"></div>
                <a href="#" class="button" id="action_SelectAll" title="Select All">All</a>
                <a href="#" class="button" id="action_SelectNone" title="Select None">None</a>
                <input type="text" id="Search" class="medium" /><a href="#" class="button" id="action_Search" title="Search"><img src="images/magnifying_glass_alt_12x12.png" /></a>
            </div>
            <div class="clear"></div>
            <div id="Artists" class="smsection floatleft noselect" tabindex="0">
                <ul id="ArtistContainer" class="simplelist mainlist"></ul>
            </div>
            <div id="Albums" class="lgsection floatleft noselect">
                <div class="loading"></div>
                <ul id="AlbumContainer" class="simplelist songlist"></ul>
            </div>
        </div>
        <div id="tabPlaylists" class="tabcontent">
            <div class="actions floatleft">
                <a href="#" class="button" id="action_NewPlaylist" onclick="newPlaylist(); return false;" title="New Playlist">+ New</a>
                <a href="#" class="button" id="action_DeletePlaylist" title="Delete Playlist">Delete</a>
                <a href="#" class="button" id="action_SavePlaylist" title="Save Playlist">Save</a>
                <a href="#" class="button" id="action_RemoveSongs" title="Remove selected song(s) from playlist">Remove Song(s)</a>
            </div>
            <div class="clear"></div>
            <div id="Playlists" class="smsection floatleft noselect">
                <ul id="PlaylistContainer" class="simplelist mainlist"></ul>
            </div>
            <div id="Tracks" class="lgsection floatleft noselect">
                <div class="loading"></div>
                <ul id="TrackContainer" class="simplelist songlist"></ul>
            </div>
        </div>
        <div id="tabPreferences" class="tabcontent">
        <script type="text/javascript">
            $(document).ready(function () {
                $('#Username').val($.cookie('username'));
                $('#Password').val($.cookie('password'));
            });
        </script>
            <div class="fullsection floatleft">
                <div class="subsection floatleft">
                    <label for="Username">Username</label><br />
                    <input type="text" id="Username" name="Username" class="large"/><br />
                    <label for="Password">Password</label><br />
                    <input type="password" id="Password" name="Password" class="large"/><br />
                    <a href="#" class="button submit floatright" id="SavePreferences" title="Save">Save</a>
                    <a href="#" class="button submit floatright" id="ResetPreferences" title="Reset">Reset</a>
                </div>
                <div class="clear"></div>
                <div class="subsection floatleft">
                    <ul class="preferences">
                    <li class="title">Keyboard Shortcuts</li>
                    <li><em>[a-z]</em> Click the Album list, use to quickly browse to an artist</li>
                    <li><em>Spacebar</em> Play/Pause</li>
                    <li><em>&rarr;</em> Next Track</li>
                    <li><em>&larr;</em> Previous Track</li>
                    <li><span></span></li>
                    </ul>
                </div>
            </div>
            <div class="clear"></div>
        </div>

        <!-- Audio Player -->
        <div class="clear"></div>
        <div id="player">
            <div id="coverart"><img id="coverartimage" src="" /></div>
            <div id="audiocontainer" class="floatleft">
                <div class="floatleft"><audio src="" preload="none" /></div>
                <div id="playeractions" class="floatleft"><a href="#" class="button" id="Shuffle" title="Shuffle"><img src="images/fork_11x12.png" /></a></div>
            </div>
            <div class="floatleft">
                <div id="songdetails">
                    <ul>
                    <li><span class="label">Song: </span><span id="songdetails_song"></span></li>
                    <li><span class="label">Album: </span><span id="songdetails_album"></span></li>
                    <li><span class="label">Artist: </span><span id="songdetails_artist"></span></li>
                    </ul>
                </div>
            </div>
            <div class="clear"></div>
            
        </div>

    <div class="clear"></div>
    </div><!-- end #content -->
    <div class="floatright"><a href="#" title="Launch external player" onclick="popOut(); return false;"><img src="images/new_window_12x12.png" /></a></div>
</div><!-- end #container -->
</body>
</html>
